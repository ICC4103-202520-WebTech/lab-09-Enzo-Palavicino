<% content_for :title, "Recipes" %>

<div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
  <div>
    <h1 class="h2 mb-0">Recipe Book</h1>
    <p class="text-muted mb-0">Keep track of your favourite dishes and how to make them.</p>
  </div>
  <% if policy(Recipe).new? %>
    <%= link_to "New Recipe", new_recipe_path, class: "btn btn-primary" %>
  <% else %>
    <div class="d-flex gap-2">
      <%= link_to "Sign up", new_user_registration_path, class: "btn btn-outline-secondary" %>
      <%= link_to "Log in", new_user_session_path, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<% if @recipes.any? %>
  <div class="row gy-4">
    <% @recipes.each do |recipe| %>
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <h2 class="h5 card-title"><%= link_to recipe.title, recipe, class: "stretched-link" %></h2>
            <dl class="row small text-muted mb-3">
              <dt class="col-5">Cook time</dt>
              <dd class="col-7"><%= recipe.cook_time.present? ? "#{recipe.cook_time} min" : "—" %></dd>
              <dt class="col-5">Difficulty</dt>
              <dd class="col-7"><%= recipe.difficulty.presence || "—" %></dd>
            </dl>
            <p class="text-muted small mb-1">By <%= recipe.user.email %></p>
            <p class="text-body-secondary small mb-0 flex-grow-1"><%= truncate(strip_tags(recipe.instructions.to_plain_text), length: 130) %></p>
            <% if policy(recipe).update? || policy(recipe).destroy? %>
              <div class="mt-3 d-flex gap-2">
                <% if policy(recipe).update? %>
                  <%= link_to "Edit", edit_recipe_path(recipe), class: "btn btn-sm btn-outline-primary" %>
                <% end %>
                <% if policy(recipe).destroy? %>
                  <%= button_to "Delete", recipe, method: :delete,
                        form: { data: { turbo_confirm: "Are you sure you want to delete this recipe?" }, class: "d-inline" },
                        class: "btn btn-sm btn-outline-danger" %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="text-center py-5 bg-light rounded-3 border">
    <p class="lead mb-3">You don't have any recipes yet.</p>
    <% if policy(Recipe).new? %>
      <%= link_to "Create your first recipe", new_recipe_path, class: "btn btn-primary" %>
    <% else %>
      <%= link_to "Sign up to start cooking", new_user_registration_path, class: "btn btn-primary" %>
    <% end %>
  </div>
<% end %>
